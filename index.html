<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Park Objection Letter Generator - Walled Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .action-button { transition: all 0.2s; }
        .action-button:hover { transform: translateY(-1px); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .styled-hr { border: none; height: 1px; background-color: #e5e7eb; margin: 1.5rem 0; }
        /* Style for the generated output box */
        #letterOutput {
            white-space: pre-wrap;
            min-height: 400px;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-blue-800 text-white p-6 shadow-xl">
            <div class="container mx-auto max-w-6xl">
                <h1 class="text-3xl font-bold">üå≥ College Park Community Action Hub</h1>
                <p class="mt-1 text-blue-200">The most effective way to register your objection against the developer's breaches.</p>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto max-w-6xl flex">
                <button class="tab-button active text-gray-700 font-semibold py-4 px-6 border-b-4 border-blue-600" data-tab="generator">
                    ‚úçÔ∏è Letter Generator
                </button>
                <button class="tab-button text-gray-500 font-medium py-4 px-6 border-b-4 border-transparent hover:border-gray-300" data-tab="flyer">
                    üì∞ Community Flyer / Guide
                </button>
            </div>
        </nav>

        <main class="container mx-auto max-w-6xl p-4 md:p-8">

            <!-- Tab Content: Letter Generator -->
            <div id="generator" class="tab-content active">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 border-b pb-2">Step 1: Customize Your Objection Letter</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Controls Column -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-100 h-fit sticky top-20">
                        <h3 class="text-xl font-semibold mb-4 text-blue-700">Your Details</h3>
                        <div class="space-y-4">
                            <input type="text" id="userName" placeholder="Your Full Name(s)" class="w-full p-2 border border-gray-300 rounded" oninput="generateLetter()">
                            <input type="text" id="userAddress" placeholder="Your House Number and Street Address" class="w-full p-2 border border-gray-300 rounded" oninput="generateLetter()">
                            <input type="text" id="userPostcode" placeholder="Your Postcode" class="w-full p-2 border border-gray-300 rounded" oninput="generateLetter()">
                        </div>

                        <div class="styled-hr"></div>

                        <h3 class="text-xl font-semibold mb-4 text-blue-700">Tone & Focus</h3>
                        <label for="toneSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Letter Tone:</label>
                        <select id="toneSelect" class="w-full p-2 border border-gray-300 rounded bg-white" onchange="generateLetter()">
                            <option value="formal">1. Formal and Structured (Legal Focus)</option>
                            <option value="passionate">2. Passionate and Value-Focused (Community Focus)</option>
                            <option value="assertive">3. Assertive and Enforcement-Driven (Action Focus)</option>
                        </select>

                        <div class="styled-hr"></div>

                        <h3 class="text-xl font-semibold mb-4 text-blue-700">Optional Arguments</h3>
                        <div class="space-y-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="includeFencing" class="form-checkbox h-5 w-5 text-blue-600 rounded" onchange="generateLetter()">
                                <span class="text-gray-700">Include **Fencing** Breach (Sports Plot)</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" id="includeProcedural" class="form-checkbox h-5 w-5 text-blue-600 rounded" onchange="generateLetter()" checked>
                                <span class="text-gray-700">Include **Procedural Failure** (No Notification)</span>
                            </label>
                        </div>

                        <div class="styled-hr"></div>
                        <p class="text-sm text-gray-600">Note: The letter uses advanced randomization to create unique phrasing for every submission.</p>

                    </div>

                    <!-- Output Column -->
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-bold text-gray-900 mb-4">Step 2: Review and Personalize</h2>
                        
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 text-yellow-800 mb-6">
                            <p class="font-semibold">‚ö†Ô∏è IMPORTANT:</p>
                            <p class="text-sm mt-1">Please read and amend the letter as you desire it to be. Add your own unique thoughts and experiences to strengthen your objection before copying and sending.</p>
                        </div>
                        
                        <textarea id="letterOutput" class="w-full p-4 border border-gray-300 rounded-lg shadow-inner bg-white text-gray-800 text-base leading-relaxed" readonly></textarea>

                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6">
                            <button id="copyButton" class="action-button bg-green-600 text-white font-bold py-3 px-6 rounded-lg flex-1 hover:bg-green-700" onclick="copyLetter()">
                                üìã Copy Letter to Clipboard
                            </button>
                            <div class="flex-1 bg-blue-100 p-3 rounded-lg text-sm text-gray-700">
                                <p class="font-semibold">Recipient:</p>
                                <p class="break-all">jill.stephens@cheshirewestandchester.gov.uk</p>
                            </div>
                        </div>

                        <div id="copy-message" class="mt-4 p-3 text-center text-green-800 bg-green-100 rounded-lg hidden">
                            Letter copied to clipboard successfully! Now paste it into your email.
                        </div>

                        <div class="mt-6 p-4 bg-gray-100 rounded-lg">
                            <h4 class="font-semibold mb-2">Suggested Subject Line Variation:</h4>
                            <p id="subjectHint" class="text-sm text-gray-700 italic"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Community Flyer / Guide -->
            <div id="flyer" class="tab-content">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Alternative: Write Your Own Letter (Key Facts & Guide)</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <!-- Flyer content starts here (Copy of the markdown flyer) -->
                    <h3 class="text-3xl font-extrabold text-red-700 mb-4 text-center">üõë FORMAL OBJECTION GUIDE: Walled Garden Breach</h3>
                    <p class="text-gray-700 text-center mb-6">Use these facts to write your own unique letter, or use the generator tool!</p>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                        <p class="font-bold text-blue-800">ACTION REQUIRED:</p>
                        <p class="mt-1 text-blue-700">Email your objection to: **jill.stephens@cheshirewestandchester.gov.uk**</p>
                        <p class="mt-1 text-blue-700">Deadline: **ASAP**</p>
                    </div>

                    <h4 class="text-xl font-bold text-gray-900 mb-3">1. CORE REFERENCES (MUST INCLUDE)</h4>
                    <table class="min-w-full divide-y divide-gray-200 mb-6 border border-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reference Type</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reference Number / Fact</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">Application to Refuse</td>
                                <td class="px-3 py-2 whitespace-nowrap text-sm text-red-600 font-semibold">25/00853/DIS (Discharge Condition 27)</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">Original Planning Permission</td>
                                <td class="px-3 py-2 whitespace-nowrap text-sm">21/03468/FUL</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">Developer‚Äôs Plan Reference</td>
                                <td class="px-3 py-2 whitespace-nowrap text-sm">P.1706.22 (Landscape Management Plan)</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">Walled Garden Designation</td>
                                <td class="px-3 py-2 whitespace-nowrap text-sm">Public Open Space (POS)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="text-xl font-bold text-gray-900 mb-3">2. FACTS ON DESTRUCTION & SCALE OF LOSS</h4>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4 mb-6">
                        <li>The developer illegally **removed 12 rare apple trees** that were originally present and subject to a strict retention agreement.</li>
                        <li>The approved plan required the planting of **54 new fruit trees** and **$2,391 \text{m}^2$ of Germinal Eco Species Rich Lawn**. None of this was delivered.</li>
                        <li>The developer scored the destroyed, barren land as **zero (0) biodiversity** (filed 31 July 2025) to justify avoiding on-site restoration.</li>
                        <li>The promise of **public access** was pivotal to the original consent (Ref: Christleton Parish Council Letter to CEO, 12 March 2025).</li>
                    </ul>

                    <h4 class="text-xl font-bold text-gray-900 mb-3">3. PATTERN OF NON-COMPLIANCE & RISK</h4>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4 mb-6">
                        <li>The proposal for an **off-site cash payment** for a replacement orchard is inadequate and unacceptable to the community.</li>
                        <li>**Unauthorized Fencing:** The developer also fenced off the Sports England green space, restricting resident access, demonstrating a pattern of removing public amenities.</li>
                        <li>**Procedural Failure:** The Council failed to notify adjoining residents about application 25/00853/DIS, violating administrative fairness (DMPO 2015).</li>
                        <li>**Goalpost Strategy:** The developer has already changed the design for the property once. If the required vegetation is lost, this will have little to prevent a large building site appearing with potentially many more properties, making the site **unrecognisable.**</li>
                    </ul>

                    <h4 class="text-xl font-bold text-gray-900 mb-3">4. CALL TO UNITY & ACTION (The Demands)</h4>
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 text-red-800">
                        <p class="font-bold text-xl mb-2">WE DEMAND THE COUNCIL:</p>
                        <ul class="list-decimal list-inside space-y-1 ml-4 text-lg">
                            <li>**REFUSE** Discharge of Condition 27 (25/00853/DIS).</li>
                            <li>**IMMEDIATELY INITIATE ENFORCEMENT ACTION** to compel the developer to reinstate the Walled Garden (all 66 trees + public access).</li>
                            <li>**Order the IMMEDIATE REMOVAL** of the unauthorised fencing on the Sports England plot.</li>
                        </ul>
                    </div>

                    <div class="mt-8 p-4 bg-gray-100 rounded-lg text-center">
                        <p class="font-bold text-lg text-gray-800">ü§ù A Call to the Community:</p>
                        <p class="text-gray-700 mt-2">We need to work together as a community, stick up for each other otherwise before we know it, we will live on an estate of 100 houses without the facilities to support nor the beauty of the site and area.</p>
                    </div>
                    
                    <div class="mt-6 p-3 bg-yellow-100 border border-yellow-300 rounded-lg text-center">
                        <p class="font-bold text-orange-700">YOUR LETTER</p>
                        <p class="text-sm text-orange-700 mt-1">Do not copy this flyer! Write your points in your own words or personalise the generator.</p>
                    </div>
                    
                    <!-- Flyer content ends here -->
                </div>
            </div>
            
        </main>
    </div>

    <!-- JavaScript for Functionality (Tab Switching, Generator Logic, Copying) -->
    <script>
        const $ = (id) => document.getElementById(id);
        const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
        
        // --- Core Content Pool for Randomization (V7) ---
        const ALL_PHRASES = {
            // General structure elements and non-varying facts
            core: {
                subjectPrefix: ['FORMAL OBJECTION AGAINST APPLICATION 25/00853/DIS', 'URGENT OBJECTION TO THE DISCHARGE OF CONDITION 27', 'PLANNING VIOLATION CONCERNING 25/00853/DIS'],
                refString: `(Original Planning: 21/03468/FUL; Developer Plan: P.1706.22)`,
                introLead: [
                    'I am writing to register my strongest possible objection to the application for the Discharge of Condition 27, ref 25/00853/DIS. This submission fundamentally compromises the integrity of the planning system,',
                    'As a concerned resident and homeowner, I vehemently oppose the application for Discharge of Condition 27 (25/00853/DIS). This document seeks to retroactively forgive a severe, willful breach of core planning mandates,',
                    'Please treat this correspondence as my formal and decisive objection to the developer\'s attempt to discharge Condition 27 (ref 25/00853/DIS). The application is a direct affront to the commitments made to the local community,',
                ],
                introConnect: [
                    'as it attempts to retroactively excuse a severe, wilful breach of a core planning condition.',
                    'by attempting to discharge a condition that protects a vital community asset.',
                    'as it seeks to legalize the total destruction of a key public amenity.',
                ],
                closingStatement: [
                    'For the sake of upholding planning law, maintaining community trust, and preserving the character of our area, I urge the Planning Team to act decisively.',
                    'The integrity of the planning process demands that this application be rejected. I trust the Council will prioritize enforcement and resident amenity over developer convenience.',
                    'I expect the Council to uphold the original terms of consent. Your enforcement is essential to prevent future degradation of our living environment.',
                ],
            },
            
            // 1. Walled Garden Breach arguments (High Variance)
            walledGarden: {
                header: ['Deliberate Breach of Mandated Public Access and Planting', 'Willful Destruction of a Key Community Asset', 'Failure to Enforce Walled Garden Obligations'],
                rareTreeSentence: [
                    'The original consent mandated the retention of 12 rare apple trees, which were summarily removed entirely during construction.',
                    'A strict retention agreement was breached when 12 rare apple trees were cleared from the site.',
                    'The destruction of the 12 rare apple trees, originally present on the plot, demonstrates the developer\'s total disregard for environmental conditions.',
                ],
                plantingLossSentence: [
                    'In addition to the lost rare trees, the approved plans required the planting of 54 new fruit trees alongside $2,391 \\text{m}^2$ of Germinal Eco Species Rich Lawn.',
                    'The scale of the failure is massive: 54 new fruit trees and over $2,300 \\text{m}^2$ of species-rich lawn remain unplanted, constituting a total breach of the landscape scheme.',
                    'The approved scheme, requiring 54 new fruit trees and a significant area of rich lawn (around $2,391 \\text{m}^2$), has been completely abandoned.',
                ],
                accessPromiseSentence: [
                    'The Walled Garden was explicitly designated as Public Open Space (POS) on the developer\'s plan (P.1706.22, Page 30), guaranteeing public access to residents.',
                    'Public access to the Walled Garden was a non-negotiable term of the original consent, documented as Public Open Space (POS).',
                    'The commitment to public access, noted in Parish Council correspondence, was a pivotal condition that has now been unilaterally withdrawn.',
                ],
            },

            // 2. Misrepresentation / Low Score arguments (High Variance)
            misrepresentation: {
                header: ['Misrepresentation and Manipulation via Low Biodiversity Score', 'Developer Strategy to Justify Destruction', 'The Low Biodiversity Valuation Tactic'],
                valuationTactic: [
                    'By scoring the destroyed, cleared land as "zero (0)" biodiversity, the developer is cynically attempting to use their own unpunished act of destruction to legally justify avoiding on-site reinstatement.',
                    'The developer\'s filing (dated 31 July 2025) which scores the cleared land as "Artificial Unvegetated" with a value of zero, is a transparent tactic to manipulate the enforcement process.',
                    'It is shocking that the developer assigns zero biodiversity value to the plot *after* actively stripping it. This is a direct attempt to normalize the breach.',
                ],
                offSiteInadequacy: [
                    'The proposal for a cash sum to fund an off-site replacement is entirely inadequate and unacceptable.',
                    'The value of this space is immeasurable‚Äîvisually, socially, and ecologically‚Äîon our doorstep; it cannot be replaced by a remote financial contribution.',
                    'A substitute off-site orchard fails to deliver the specific amenity promised to residents and should be rejected outright.',
                ],
                proceduralFailure: [
                    'The Council failed to notify adjoining residents about the critical Discharge application (25/00853/DIS), a serious breach of administrative fairness.',
                    'This lack of notification prevents public scrutiny of a proposal that fundamentally removes a community asset.',
                    'I demand an explanation, referencing the DMPO 2015, as to why this material change was deemed non-notifiable.',
                ],
            },
            
            // 3. Fencing and Goalpost arguments (High Variance)
            fencing: {
                header: ['Unauthorised Restriction of Secondary Green Space', 'Pattern of Changing Goalposts and Over-Development Risk'],
                fencingBreach: [
                    'I formally object to the developer‚Äôs unauthorised fencing of the Sports England green space opposite the new development.',
                    'The sudden, unapproved fencing restricts resident access to a promised communal space under the pretext of public safety.',
                    'This simultaneous action of fencing off the Sports England plot demonstrates a clear pattern of removing all available public land for potential future use.',
                ],
                goalpostRisk: [
                    'This pattern of changing goalposts and non-compliance, if allowed, will ultimately result in the site becoming unrecognizable and lacking the facilities to support the new community.',
                    'If enforcement is not initiated now, there will be little to prevent this site from becoming a large building project with potentially many more properties, destroying the area\'s character.',
                    'Allowing this discharge sets a dangerous precedent, greenlighting future applications that further degrade the visual and environmental quality of the estate.',
                ],
            },
            
            // 4. Demands (High Variance)
            demands: {
                refuse: ['REFUSE Discharge of Condition 27 (25/00853/DIS) unequivocally.', 'The application to discharge Condition 27 must be rejected immediately.', 'I demand the Planning Team refuse application 25/00853/DIS without compromise.'],
                enforcement: ['INITIATE ENFORCEMENT ACTION to compel the developer to fully reinstate the Walled Garden, including all 66 trees and guaranteed public access.', 'Issue an enforcement notice requiring the immediate reinstatement of the Walled Garden orchard, complete with all 66 trees and community access.', 'Compel the developer to physically reinstate the Public Open Space (Walled Garden) as per the original mandate.'],
                fencing: ['Order the IMMEDIATE REMOVAL of the unauthorised fencing on the Sports England plot.', 'Require the removal of the new fencing and guarantee resident access to the Sports England plot.', 'Demand that the developer immediately restores access to the Sports England green space.'],
            },

            // Tone-specific arrays (must select one option from each array)
            formal: {
                subjectPrefix: ['FORMAL OBJECTION: Statutory Breach of Planning Condition 27', 'PLANNING ENFORCEMENT REQUIRED: Breach of 21/03468/FUL'],
                closingSalutation: 'I await confirmation that definitive enforcement action will be taken.',
                introHook: 'I submit this objection to request the Council uphold the integrity of the planning process.',
                introContext: 'This application, 25/00853/DIS, facilitates the retroactive legalization of a material breach of the original consent terms,',
            },
            passionate: {
                subjectPrefix: ['URGENT PLEA: Protect Our Walled Garden and Community Amenity', 'BROKEN PROMISE: Residents Demand On-Site Orchard Restoration'],
                closingSalutation: 'I sincerely hope the Council will stand with its residents and enforce the promise that was made.',
                introHook: 'I write to express my profound disappointment and anger regarding the developer\'s attempts to evade their core obligations.',
                introContext: 'This application is an unacceptable attempt to erase a vital communal amenity that residents bought into,',
            },
            assertive: {
                subjectPrefix: ['DIRECT DEMAND FOR ACTION: Non-Compliance and Procedural Failure (25/00853/DIS)', 'COUNCIL ACCOUNTABILITY: Reject the Discharge & Issue Enforcement Notice'],
                closingSalutation: 'I expect timely and decisive action and demand written justification for any delay.',
                introHook: 'The time for negotiation is over. This application is a clear attempt to rubber-stamp a willful planning breach.',
                introContext: 'The Council must prioritize its duty to enforce statutory conditions over developer convenience,',
            },
        };

        const generateLetter = () => {
            const userName = $('userName').value;
            const userAddress = $('userAddress').value;
            const userPostcode = $('userPostcode').value;
            const toneStyle = $('toneSelect').value;
            const includeFencing = $('includeFencing').checked;
            const includeProcedural = $('includeProcedural').checked;

            const now = new Date();
            const date = now.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

            const signaturePlaceholder = '[Your Signature (if sending hard copy)]';
            const signatureLine = `\n${signaturePlaceholder}\n\n${userName}\nResident and Homeowner`;
            
            const selectedStyle = ALL_PHRASES[toneStyle];
            
            // --- 1. Assemble Header and Introduction ---
            let letter = `${rand(selectedStyle.subjectPrefix)} ${ALL_PHRASES.core.refString}\n`;
            letter += `\n${rand(ALL_PHRASES.core.introLead)} ${rand(selectedStyle.introContext)} ${rand(ALL_PHRASES.core.introConnect)}\n\n`;
            
            // --- 2. Build Argument Sections (Shuffled) ---
            const sections = [];

            // A. Walled Garden Breach (Mandatory Core Argument)
            sections.push(`
**1. ${rand(ALL_PHRASES.walledGarden.header)}**
The original planning permission (21/03468/FUL) was contingent on core obligations that have been decisively violated:
* ${rand(ALL_PHRASES.walledGarden.rareTreeSentence)}
* ${rand(ALL_PHRASES.walledGarden.plantingLossSentence)}
* ${rand(ALL_PHRASES.walledGarden.accessPromiseSentence)}
`);

            // B. Misrepresentation / Low Score (Mandatory Core Argument)
            sections.push(`
**2. ${rand(ALL_PHRASES.misrepresentation.header)}**
The developer is cynically attempting to use the Discharge application to legalize their pre-existing breach:
* ${rand(ALL_PHRASES.misrepresentation.valuationTactic)}
* ${rand(ALL_PHRASES.misrepresentation.offSiteInadequacy)}
${includeProcedural ? `* **Procedural Failure:** ${rand(ALL_PHRASES.misrepresentation.proceduralFailure)}` : ''}
`);

            // C. Fencing and Goalposts (Optional/Variable Argument)
            if (includeFencing) {
                sections.push(`
**3. ${rand(ALL_PHRASES.fencing.header)}**
The developer's actions show a clear strategy to maximize private land at the community\'s expense:
* ${rand(ALL_PHRASES.fencing.fencingBreach)}
* ${rand(ALL_PHRASES.fencing.goalpostRisk)}
`);
            } else {
                 sections.push(`
**3. Pattern of Erosion and Over-Development Risk**
The developer's pattern of broken promises shows a clear strategy to maximize private land at the community\'s expense:
* ${rand(ALL_PHRASES.fencing.goalpostRisk)}
`);
            }
            
            // Shuffle arguments for uniqueness
            for (let i = sections.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [sections[i], sections[j]] = [sections[j], sections[i]];
            }

            letter += sections.join('\n');

            // --- 3. Demands ---
            letter += `\n\n**DEMAND FOR IMMEDIATE ENFORCEMENT ACTION**\n`;
            letter += `For the reasons outlined above, I formally request that the Planning Team takes the following definitive steps:\n\n`;
            
            const demands = [
                `1. ${rand(ALL_PHRASES.demands.refuse)}`,
                `2. ${rand(ALL_PHRASES.demands.enforcement)}`,
            ];

            if (includeFencing) {
                demands.push(`3. ${rand(ALL_PHRASES.demands.fencing)}`);
            }

            // Shuffle demands for final uniqueness
            for (let i = demands.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [demands[i], demands[j]] = [demands[j], demands[i]];
            }

            letter += demands.join('\n');
            
            // --- 4. Closing ---
            letter += `\n\n${rand(selectedStyle.closingSalutation)}\n\n`;

            const finalLetter = `${userName}\n${userAddress}\n${userPostcode}\n\n${date}\n\n**To the Planning Team at Cheshire West Council**\n\n${letter}\n\n${signatureLine}`;
            
            $('letterOutput').value = finalLetter;
            
            // Update Subject Hint
            $('subjectHint').textContent = `${rand(selectedStyle.subjectPrefix)} [Add Your Own Unique Prefix/Suffix]`;
        };
        
        const copyLetter = () => {
            const letterTextarea = $('letterOutput');
            letterTextarea.select();
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(letterTextarea.value).then(() => {
                    showCopyMessage();
                });
            } else {
                try {
                    document.execCommand('copy');
                    showCopyMessage();
                } catch (err) {
                    console.error('Failed to copy text.');
                    alert('Failed to copy text. Please copy it manually.');
                }
            }
        };

        const showCopyMessage = () => {
            const copyMessage = $('copy-message');
            copyMessage.classList.remove('hidden');
            setTimeout(() => {
                copyMessage.classList.add('hidden');
            }, 3000);
        };

        // Initial generation and tab setup
        document.addEventListener('DOMContentLoaded', () => {
            generateLetter();

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(b => {
                        b.classList.remove('active', 'border-blue-600', 'text-gray-700', 'font-semibold');
                        b.classList.add('text-gray-500', 'border-transparent', 'hover:border-gray-300', 'font-medium');
                    });
                    this.classList.add('active', 'border-blue-600', 'text-gray-700', 'font-semibold');
                    this.classList.remove('text-gray-500', 'border-transparent', 'hover:border-gray-300', 'font-medium');

                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    $('index').classList.add('active'); // Fallback in case ID is dynamic
                    document.getElementById(this.dataset.tab).classList.add('active');
                    generateLetter();
                });
            });
        });
    </script>
</body>
</html>
